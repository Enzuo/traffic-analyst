import{d as N,A as ce,B as he,M as fe,e as W,P as me,f as ge,g as pe}from"./loader.CaIUhdO0.js";import{c as G}from"./CarEntity3D.DIBYzGMn.js";import{s as D,V as T,W as X,b as y,f as p,X as B,p as C,i as v,h as A,n as z,e as k,a as K,B as S,c as P,g as Y,t as J,d as O,l as Q}from"./scheduler.C19aQTI2.js";import{S as j,i as I,a as b,g as Z,t as q,e as $,c as ee,b as te,m as re,d as se}from"./index.B0knyX5n.js";import{u as ne}from"./uPlot.min.Sk6Afor8.js";import{b as E,c as V,d as de,e as U,t as we}from"./index.JSGz7vAS.js";class De extends N{constructor(r){super(),ae(this.scene),this.animation=new pe(this.scene,this.camera,this.renderer,this.cameraControls),this.animation.start(),G(r).then(n=>this.animation.setCar(n.object))}updateData(r){this.animation.removeCar().then(n=>{n&&this.scene.remove(n)}),G(r).then(n=>this.animation.setCar(n.object))}}class Ae extends N{constructor(r,n,t){super(),this.animation=new ce(this.scene,this.camera,this.renderer,this.cameraControls,n),this.animation.start();const i=_e(this.scene);this.animation.addAnimated(i),ae(this.scene),r.forEach((e,s)=>{const u=s*3-(r.length-1)*3/2;G(e,t[s]).then(_=>{this.scene.add(_.object),_.object.position.x=u,this.animation.addAnimatedObject(_)})})}}function _e(a){const r=new he,n=new fe({color:65280}),t=new W(r,n);t.position.y=2,t.castShadow=!0,a.add(t),t.position.z=-3,t.position.x=-3;function i(e){t.rotation.x+=.01,t.rotation.y+=.01}return{animate:i,object:t}}function ae(a,r=10){const n=new me(10,r),t=new ge({color:16777215}),i=new W(n,t);i.rotation.x=-Math.PI/2,i.receiveShadow=!0,a.add(i)}function ve(a){let r,n,t,i,e;return{c(){r=T("svg"),n=T("use"),this.h()},l(s){r=X(s,"svg",{class:!0,style:!0});var o=y(r);n=X(o,"use",{"xlink:href":!0}),y(n).forEach(p),o.forEach(p),this.h()},h(){B(n,"xlink:href",t="symbol-defs.svg#icon-"+a[0]),C(r,"class",i="icon icon-"+a[0]+" svelte-8w0jsv"),C(r,"style",e=`width: ${1*a[1]}em; height: ${1*a[1]}em;`)},m(s,o){v(s,r,o),A(r,n)},p(s,[o]){o&1&&t!==(t="symbol-defs.svg#icon-"+s[0])&&B(n,"xlink:href",t),o&1&&i!==(i="icon icon-"+s[0]+" svelte-8w0jsv")&&C(r,"class",i),o&2&&e!==(e=`width: ${1*s[1]}em; height: ${1*s[1]}em;`)&&C(r,"style",e)},i:z,o:z,d(s){s&&p(r)}}}function be(a,r,n){let{name:t}=r,{size:i=1}=r;return a.$$set=e=>{"name"in e&&n(0,t=e.name),"size"in e&&n(1,i=e.size)},[t,i]}class ie extends j{constructor(r){super(),I(this,r,be,ve,D,{name:0,size:1})}}function xe(a,r,n={}){let t=[[]],i=[];const e=["blue","red","orange","green","purple","grey","grey","grey","grey","grey","grey","grey"];for(let l=0;l<a.gearbox.gearRatio.length;l++)i.push({label:l+1,scale:"n",value:(f,c)=>c==null?"-":c.toFixed(0),stroke:e[l]}),t.push([]);let s={label:"drag",scale:"n",value:(l,f)=>f==null?"-":f.toFixed(1),stroke:"darkgrey"};t.push([]);const o=2,u=200;let _=0;const h=a.engine.torqueCurve.length?a.engine.torqueCurve[0][0]:0,d=a.engine.torqueCurve.length?a.engine.torqueCurve[a.engine.torqueCurve.length-1][0]:0;for(;_<=u;){t[0].push(_);let l=_/3.6;if(a.type==="plane"){let c;if(a.engine.thrust)c=a.engine.thrust;else{let g=E(a.engine.torqueCurve,2700);c=U(g,5.325,1,200)}t[1].push(c),t[t.length-1].push(V(l,a.weight,a.dragArea*a.dragCoef)),_+=o;continue}let f=a.gearbox;for(let c=0;c<f.gearRatio.length;c++){let g=f.gearRatio[c]*f.driveRatio*(f.gearTransfer?f.gearTransfer[0]:1),x=de(l,g,a.wheelDiameter),M=E(a.engine.torqueCurve,x,a.engine.power),F=U(M,g,null,a.wheelDiameter);n.isGearForce?t[c+1].push(F):x>h&&x<d?t[c+1].push(x):t[c+1].push(null)}n.isGearForce&&t[t.length-1].push(V(l,a.weight,a.dragArea*a.dragCoef)),_+=o}const w={title:"Gearing",width:800,height:300,cursor:{drag:{setScale:!1}},series:[{label:"km/h"},...i,s],scales:{x:{title:"speed",time:!1},y:{}},axes:[{},{space:60,scale:"n",values:(l,f,c)=>f.map(g=>+g.toFixed(0)),side:1,grid:{show:!1}}]};let m=new ne(w,t,r);return{setData:l=>{m.setData(l)}}}function H(a){let r,n,t,i;return t=new ie({props:{name:"wrench"}}),{c(){r=k("div"),n=J("!"),ee(t.$$.fragment),this.h()},l(e){r=P(e,"DIV",{class:!0});var s=y(r);n=O(s,"!"),te(t.$$.fragment,s),s.forEach(p),this.h()},h(){C(r,"class","graph-error")},m(e,s){v(e,r,s),A(r,n),re(t,r,null),i=!0},i(e){i||(b(t.$$.fragment,e),i=!0)},o(e){q(t.$$.fragment,e),i=!1},d(e){e&&p(r),se(t)}}}function Ce(a){let r,n,t,i,e=a[1]&&H();return{c(){r=k("div"),n=K(),e&&e.c(),t=S()},l(s){r=P(s,"DIV",{}),y(r).forEach(p),n=Y(s),e&&e.l(s),t=S()},m(s,o){v(s,r,o),a[4](r),v(s,n,o),e&&e.m(s,o),v(s,t,o),i=!0},p(s,[o]){s[1]?e?o&2&&b(e,1):(e=H(),e.c(),b(e,1),e.m(t.parentNode,t)):e&&(Z(),q(e,1,1,()=>{e=null}),$())},i(s){i||(b(e),i=!0)},o(s){q(e),i=!1},d(s){s&&(p(r),p(n),p(t)),a[4](null),e&&e.d(s)}}}function ye(a,r,n){let{car:t}=r,{showForce:i=!0}=r,e,s;function o(u){Q[u?"unshift":"push"](()=>{e=u,n(0,e),n(2,t),n(3,i)})}return a.$$set=u=>{"car"in u&&n(2,t=u.car),"showForce"in u&&n(3,i=u.showForce)},a.$$.update=()=>{if(a.$$.dirty&13&&e){n(0,e.innerHTML="",e);try{xe(t,e,{isGearForce:i}),n(1,s=!1)}catch{n(1,s=!0)}}},[e,s,t,i,o]}class je extends j{constructor(r){super(),I(this,r,ye,Ce,D,{car:2,showForce:3})}}function qe(a,r,n={}){let t=n.colors?n.colors:["blue","red","orange","green"],i=[];for(let h=0;h<a.length;h++){a[h];let d={label:"torque",scale:"nm",value:(m,l)=>l==null?"-":l.toFixed(0),stroke:t[h],dash:[10,5],spanGaps:!0,points:{show:!1}},w={label:"power",scale:"hp",value:(m,l)=>l==null?"-":l.toFixed(0),stroke:t[h],spanGaps:!0,points:{show:!1}};i.push(d),i.push(w)}function e(h,d=100){let w=0,m=h.map(g=>g.engine.torqueCurve[g.engine.torqueCurve.length-1][0]),l=Math.max(...m),f=[];for(var c=w;c<=l;c+=d)f.push(c);return f}function s(h,d){let w=h.engine;w.torqueXMultiplier;let m=E(w.torqueCurve,d,w.power),l=we(m,d);return{torque:m,power:l}}function o(h){let d=h.map(g=>g.engine.torqueCurve[g.engine.torqueCurve.length-1][0]),w=Math.max(...d),m=100;w<500&&(m=25);let l=e(h,m),f=[l];for(var c=0;c<h.length;c++){let g=h[c];g.engine.torqueXMultiplier;let M=[],F=[];for(let R=0;R<l.length;R++){let oe=l[R],{torque:le,power:ue}=s(g,oe);M.push(le),F.push(ue)}f.push(M),f.push(F)}return f}let u=o(a);const _={title:"Power",width:800,height:300,cursor:{drag:{setScale:!1}},series:[{},...i],scales:{x:{title:"rpm",time:!1},hp:{}},axes:[{},{space:60,scale:"nm",values:(h,d,w)=>d.map(m=>+m.toFixed(0)),side:1,grid:{show:!1}},{space:60,scale:"hp",values:(h,d,w)=>d.map(m=>+m.toFixed(0)),side:1,grid:{show:!1}}]};new ne(_,u,r)}function L(a){let r,n,t,i;return t=new ie({props:{name:"wrench"}}),{c(){r=k("div"),n=J("!"),ee(t.$$.fragment),this.h()},l(e){r=P(e,"DIV",{class:!0});var s=y(r);n=O(s,"!"),te(t.$$.fragment,s),s.forEach(p),this.h()},h(){C(r,"class","graph-error")},m(e,s){v(e,r,s),A(r,n),re(t,r,null),i=!0},i(e){i||(b(t.$$.fragment,e),i=!0)},o(e){q(t.$$.fragment,e),i=!1},d(e){e&&p(r),se(t)}}}function Me(a){let r,n,t,i,e=a[1]&&L();return{c(){r=k("div"),n=K(),e&&e.c(),t=S()},l(s){r=P(s,"DIV",{}),y(r).forEach(p),n=Y(s),e&&e.l(s),t=S()},m(s,o){v(s,r,o),a[4](r),v(s,n,o),e&&e.m(s,o),v(s,t,o),i=!0},p(s,[o]){s[1]?e?o&2&&b(e,1):(e=L(),e.c(),b(e,1),e.m(t.parentNode,t)):e&&(Z(),q(e,1,1,()=>{e=null}),$())},i(s){i||(b(e),i=!0)},o(s){q(e),i=!1},d(s){s&&(p(r),p(n),p(t)),a[4](null),e&&e.d(s)}}}function Fe(a,r,n){let{cars:t}=r,{opts:i={}}=r,e,s;function o(u){Q[u?"unshift":"push"](()=>{e=u,n(0,e),n(2,t),n(3,i)})}return a.$$set=u=>{"cars"in u&&n(2,t=u.cars),"opts"in u&&n(3,i=u.opts)},a.$$.update=()=>{if(a.$$.dirty&13&&e){n(0,e.innerHTML="",e);try{qe(t,e,i),n(1,s=!1)}catch{n(1,s=!0)}}},[e,s,t,i,o]}class Ie extends j{constructor(r){super(),I(this,r,Fe,Me,D,{cars:2,opts:3})}}export{ie as I,Ae as S,je as U,Ie as a,De as b};
